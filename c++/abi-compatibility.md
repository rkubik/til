# Enforcing ABI Compatibility

Maintaining C++ dynamic shared libraries can be a difficult process if no
processes are in place to ensure ABI compatibility. A great tool for this
is abi-compliance-checker. On Debian systems this is easily installed via
`apt-get install abi-compliance-checker`.

Note: the library must be compiled with `-g -Og` GCC options to contain
DWARF debug info to ensure a thorough ABI check.

There are a few different combinations providing the tool with the library
ABI but we will address two.

1. XML-descriptor: a default file can be generated with
`abi-compliance-checker -b`. This file represents what library headers and
shared objects to use for the ABI check. If using this method the command
would look as follows (comparing two versions of the same library).

        abi-compliance-checker -lib NAME -old OLD.xml -new NEW.xml

Sample template:

    <version>
        1.0
    </version>

    <headers>
        /usr/include/logcpp
    </headers>

    <libs>
        /usr/lib/liblogcpp.so
    </libs>

2. ABI dump: generated by the `-dump` option, this method will create an archive
file containing all DSO symbols. The `-dump` option requires you to specify an
XML template. This option is useful for creating a base ABI dump for each
successor version to be compared to.

        # Create initial base ABI dump
        abi-compliance-checker -l libfoo -v1 0.1.0 -dump libfoo.xml -dump-path libfoo-base.abi.tar.gz

        # Library changes...
        ...
        # Re-build library
        ...

        # Check compatibility of new library
        abi-compliance-checker -l libfoo -d1 libfoo-base.abi.tar.gz -d2 libfoo.xml -report-path report.html
        preparation, please wait ...
        Using GCC 4.9.2 (i586-linux-gnu)
        checking header(s) 0.1.0 ...
        comparing ABIs ...
        comparing APIs ...
        creating compatibility report ...
        result: INCOMPATIBLE (Binary: 100%, Source: 0%)
        total "Binary" compatibility problems: 1, warnings: 1
        total "Source" compatibility problems: 0, warnings: 0
        see detailed report:
        report.html

# References

https://github.com/lvc/abi-compliance-checker
http://ispras.linuxbase.org/index.php/ABI_compliance_checker
